<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>e-Mal - Productos en venta</title>

    <!-- Core CSS - Include with every page -->
    <link href="<?php echo STATIC_DIR; ?>vendors/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="<?php echo STATIC_DIR; ?>vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <style type="text/css">
        body { padding-top: 70px; }

        *{
            border-radius: 0 !important;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-default navbar-fixed-top" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#"><i class="fa fa-barcode"></i> Productos en venta</a>
            </div>
            <!-- /.navbar-header -->

            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <?php require_once "partes/links.html"; ?>
                <?php require_once "partes/notificaciones.html"; ?>
            </div>
            <!-- /.navbar-top-links -->
        </div>
    </nav>
    <div class="container">
        <div class="row">
            <div class="col-lg-12 col-md-12">
                <!-- Nav tabs -->
                <ul class="nav nav-tabs nav-justified" role="tablist" style="margin:10px 0;">
                  <li id="tab1"><a href="#home" role="tab" data-toggle="tab">Agregar productos</a></li>
                  <li id="tab2"><a href="#burbujas" role="tab" data-toggle="tab">Ver productos en paneles</a></li>
                  <li class="active" id="tab3"><a href="#tabla" role="tab" data-toggle="tab">Ver productos en tabla</a></li>
                </ul>
                <!-- Tab panes -->

                <div class="tab-content">
                    <div class="tab-pane fade" id="home">
                        <div class="row">
                            <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-lg-4 col-lg-offset-4 col-md-6 col-md-offset-3">
                                <div class="panel panel-primary ">
                                    <div class="panel-heading">
                                        Agregar un producto
                                    </div>
                                    <div class="panel-body">
                                        <form role="form" id="form-agregar-producto">
                                            <div class="form-group">
                                                <input type="text" class="form-control" id="nombre-producto" placeholder="Nombre del producto" required>
                                            </div>
                                            <div class="form-group">
                                                <textarea class="form-control" rows="3" id="descripcion-producto" placeholder="Descripcion del producto" required></textarea>
                                            </div>
                                            <div class="form-group">
                                                <input type="text" class="form-control" id="marca-producto" placeholder="Marca del producto" required>
                                            </div>
                                            <div class="form-group">
                                                <select class="form-control" id="categoria-producto">
                                                    <option value=0>Seleccione una categoria</option>
                                                  <?php 
                                                    foreach ($params["categorias_productos"] as $value) {
                                                        print_r("<option value='".$value['categoria_producto']."'>".$value['categoria_producto']."</option>");     
                                                    }
                                                  ?>
                                                </select>
                                            </div>
                                            <div class="form-group">
                                                <input type="number" class="form-control" id="precio-producto" placeholder="Precio del producto" required>
                                            </div>
                                            <div class="form-group">
                                                <input type="number" class="form-control" id="cantidad-producto" placeholder="Cantidad en bodega" required>
                                            </div>
                                           
                                            <div class="form-group">
                                                <input type="file" class="filestyle" id="imagen-producto" data-buttonText="Cargar imagen" required>
                                            </div>
                                            
                                            <button type="submit" class="btn btn-primary">Agregar producto</button>
                                        </form>
                                    </div>
                                </div>
                            </div>   
                        </div>
                    </div>
                    <div class="tab-pane fade" id="burbujas">
                        <div class="row" style="padding:10px 0;">
                            <div class="col-xs-12" class="form-control">
                                <select id="select-categorias" class="form-control">
                                    <option value="-1">Seleccione una categoria</option>
                                    <option value="1">Todos</option>
                                    <?php 
                                        foreach ($params["categorias_productos"] as $value) {
                                            print_r("<option value='".$value['categoria_producto']."'>".$value['categoria_producto']."</option>");     
                                            }
                                        ?>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12" id="div-mostrar-productos-en-venta">
                                
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade in active" id="tabla">
                        
                        <div class="row" style="padding:10px 0;">
                            <div class="col-xs-12">
                                <select id="select-categorias2" class="form-control">
                                    <option value="-1">Seleccione una categoria</option>
                                    <option value="1">Todos</option>
                                    <?php 
                                        foreach ($params["categorias_productos"] as $value) {
                                            print_r("<option value='".$value['categoria_producto']."'>".$value['categoria_producto']."</option>");     
                                            }
                                        ?>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12" id="div-mostrar-tabla-productos-en-venta">
                                
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>
            
            <!-- /.col-lg-12 -->
        </div>
        
    </div>
    
    <!-- Core Scripts - Include with every page -->
    <script src="<?php echo STATIC_DIR; ?>vendors/jquery/jquery.min.js"></script>
    <script src="<?php echo STATIC_DIR; ?>vendors/bootstrap/js/bootstrap.min.js"></script>

    <script>
    $(document).on("ready", function(){
        console.log("documento listo XD");
        console.log(localStorage);
        function cargar_productos_en_paneles(categoria){
            $("#div-mostrar-productos-en-venta").html("");
            if (categoria) {
                var url = "/api/obtener-productos-en-venta?id_tienda="+localStorage.id_tienda+"&categoria-productos="+categoria;
            }else{
                var url = "/api/obtener-productos-en-venta?id_tienda="+localStorage.id_tienda;
            }
            $.ajax({
                type: "GET",
                url: url,
                success: function(data) {
                    data = JSON.parse(data);
                    console.log(data);
                    if(data.error ==  null && data.productos.length == 0){
                        if (categoria) {
                            var s = "<h2>No tiene productos de la categoria <span class='label label-info'>"+categoria+"</span> registrados</h2>"
                        }else{
                            var s = "<h2>No tiene productos registrados</h2>";
                        }
                        $("#div-mostrar-productos-en-venta").html(s);
                    }else{
                        data.productos.forEach(function(producto){
                            // producto = JSON.stringify(producto);
                            console.log(producto);
                            var p = '<div class="col-xs-6 col-sm-4 col-md-3">\
                                <div class="panel panel-default">\
                                    <div class="panel-heading">\
                                        '+producto.nombre_producto+'\
                                    </div>\
                                    <div class="panel-body">\
                                        <img src="/static/usuarios/imagenes/productos/'+producto.imagen+'" alt="'+producto.nombre_producto+'" width="100%" height="200px">\
                                        <p>'+producto.descripcion+'</p>\
                                        <p>'+producto.marca+'</p>\
                                        <p>'+producto.categoria+'</p>\
                                        <p>'+producto.precio+'</p>\
                                        <p>'+producto.stock+'</p>\
                                    </div>\
                                    <div class="panel-footer center-block">\
                                        <button class="btn btn-primary" style="width:100%; margin-bottom:10px;">Actualizar</button>\
                                        <button class="btn btn-danger" style="min-width:100%;">Eliminar</button>\
                                    </div>\
                                </div>\
                            </div>';
                            console.log(p);
                            $("#div-mostrar-productos-en-venta").append(p);
                            
                        });
                    }
                }
            });    
        }

        function cargar_productos_en_tabla(categoria){
            $("#div-mostrar-tabla-productos-en-venta").html("");
            if (categoria) {
                var url = "/api/obtener-productos-en-venta?id_tienda="+localStorage.id_tienda+"&categoria-productos="+categoria;
            }else{
                var url = "/api/obtener-productos-en-venta?id_tienda="+localStorage.id_tienda;
            }
            $.ajax({
                type: "GET",
                url: url,
                success: function(data) {
                    data = JSON.parse(data);
                    console.log(data);
                    if(data.error ==  null && data.productos.length == 0){
                        if (categoria) {
                            var s = "<h2>No tiene productos de la categoria <span class='label label-info'>"+categoria+"</span> registrados</h2>"
                        }else{
                            var s = "<h2>No tiene productos registrados</h2>";
                        }
                        $("#div-mostrar-tabla-productos-en-venta").html(s);
                    }else{
                        var t = '<div class="table-responsive">\
                            <table class="table table-bordered table-condensed table-hover">\
                                <thead>\
                                    <tr>\
                                        <th>Imagen</th>\
                                        <th>Nombre</th>\
                                        <th>Descripcion</th>\
                                        <th>Marca</th>\
                                        <th>Precio</th>\
                                        <th>Cantidad</th>\
                                        <th>Guardado por</th>\
                                        <th colspan="2">Acciones</th>\
                                    </tr>\
                                </thead>\
                                <tbody id="body-tabla-productos-en-venta">\
                                </tbody>\
                            </table>\
                        </div>';
                        $("#div-mostrar-tabla-productos-en-venta").html(t);
                        data.productos.forEach(function(producto){
                            // producto = JSON.stringify(producto);
                            console.log(producto);
                            var p = '<tr>\
                                <td><img width="30px" height="30px" src="/static/usuarios/imagenes/productos/'+producto.imagen+'" alt="'+producto.nombre_producto+'"></td>\
                                <td>'+producto.nombre_producto+'</td>\
                                <td>'+producto.descripcion+'</td>\
                                <td>'+producto.marca+'</td>\
                                <td>'+producto.precio+'</td>\
                                <td>'+producto.stock+'</td>\
                                <td>'+producto.guardado_por+'</td>\
                                <td><button type="" class="btn btn-primary">Actualizar</button></td>\
                                <td><button type="" class="btn btn-danger" >Eliminar</button></td>\
                            </tr>';
                            console.log(p);
                            $("#body-tabla-productos-en-venta").append(p);
                        });
                    }
                }
            });    
        }

        cargar_productos_en_tabla();

        $('#tab2 a').click(function (e) {
            e.preventDefault()
            console.log("click");
            cargar_productos_en_paneles();
            $(this).tab('show');
        });

        $('#tab3 a').click(function (e) {
            e.preventDefault()
            console.log("click");
            cargar_productos_en_tabla();
            $(this).tab('show');
        });


        $("#form-agregar-producto").on("submit", function(e){
            e.preventDefault();
            console.log("Se va a enviar el formularion");
            console.log("DATOS");
            var nombre = $("#nombre-producto").val();
            var descripcion = $("#descripcion-producto").val();
            var marca = $("#marca-producto").val();
            var precio = $("#precio-producto").val();
            var cantidad = $("#cantidad-producto").val();
            var imagen = $("#imagen-producto")[0].files[0];
            var categoria = $("#categoria-producto").val();
            console.log("Nombre: "+nombre);
            console.log("Descripcion: "+descripcion);
            console.log("Marca: "+marca);
            console.log("Precio: "+precio);
            console.log("Cantidad: "+cantidad);
            console.log("Categoria: "+categoria);
            console.log(imagen);
            if(categoria!=0){
                var datos = new FormData();
                datos.append("nombre", nombre);
                datos.append("descripcion", descripcion);
                datos.append("marca", marca);
                datos.append("categoria", categoria);
                datos.append("precio", precio);
                datos.append("cantidad", cantidad);
                datos.append("imagen", imagen);
                datos.append("id_tienda", localStorage.id_tienda);
                datos.append("id_admin", localStorage.id_admin);
                console.log(datos);
                $.ajax({
                    type: "POST",
                    url: "/api/agregar-a-productos-en-venta",
                    data: datos,
                    contentType: false,
                    processData: false,
                    cache:false,
                    success: function(data) {
                        console.log(data);
                        // cargar_productos();
                    }
                });
            }else{
                alert("Debe seleccionar una categoria para el producto a guardar");
            }
        })

        $("#select-categorias").on("change", function (e) {
            console.log("click categoria");
            console.log($(this).val());
            if($(this).val() != -1){
                if ($(this).val() == 1) {
                    cargar_productos_en_paneles();
                }else{
                    cargar_productos_en_paneles($(this).val());
                }
            }
        });

        $("#select-categorias2").on("change", function (e) {
            console.log("click categoria");
            console.log($(this).val());
            if($(this).val() != -1){
                if ($(this).val() == 1) {
                    cargar_productos_en_tabla();
                }else{
                    cargar_productos_en_tabla($(this).val());
                }
            }
        });
    });
    </script>
</body>

</html>
